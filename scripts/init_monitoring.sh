#!/bin/bash
set -euo pipefail

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ: ./scripts/init_monitoring.sh

echo "ðŸš€ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°"

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
check_dependencies() {
    echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Docker
    if ! command -v docker &> /dev/null; then
        echo "âŒ Docker Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
        exit 1
    fi
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Docker Compose
    if ! command -v docker-compose &> /dev/null; then
        echo "âŒ Docker Compose Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
        exit 1
    fi
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ curl
    if ! command -v curl &> /dev/null; then
        echo "âŒ curl Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
        exit 1
    fi
    
    echo "âœ… Ð’ÑÐµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹
create_directories() {
    echo "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹..."
    
    mkdir -p backups
    mkdir -p logs
    mkdir -p nginx
    mkdir -p grafana/provisioning/dashboards
    mkdir -p grafana/provisioning/datasources
    
    echo "âœ… Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
setup_environment() {
    echo "âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ..."
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ .env
    if [[ ! -f .env ]]; then
        echo "âš ï¸ Ð¤Ð°Ð¹Ð» .env Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½, ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ð¸Ð· Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°..."
        cp env.example .env
        echo "ðŸ“ ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ .env Ñ„Ð°Ð¹Ð» Ñ Ð²Ð°ÑˆÐ¸Ð¼Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼Ð¸"
    fi
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
    required_vars=("TELEGRAM_TOKEN" "POSTGRES_PASSWORD")
    missing_vars=()
    
    for var in "${required_vars[@]}"; do
        if ! grep -q "^${var}=" .env; then
            missing_vars+=("$var")
        fi
    done
    
    if [[ ${#missing_vars[@]} -gt 0 ]]; then
        echo "âš ï¸ ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ: ${missing_vars[*]}"
        echo "ðŸ“ Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¸Ñ… Ð² .env Ñ„Ð°Ð¹Ð»"
    fi
    
    echo "âœ… ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
start_services() {
    echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²..."
    
    # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹
    docker-compose up -d postgres redis
    
    # Ð–Ð´ÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
    echo "â³ ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."
    sleep 10
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð±Ð°Ð·Ðµ
    if docker-compose exec -T postgres pg_isready -U schoolbot > /dev/null 2>&1; then
        echo "âœ… Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð°"
    else
        echo "âŒ Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»Ð°ÑÑŒ"
        exit 1
    fi
    
    # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹
    docker-compose up -d
    
    echo "âœ… Ð’ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ GlitchTip
init_glitchtip() {
    echo "ðŸ”§ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ GlitchTip..."
    
    # Ð–Ð´ÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÐºÐ° GlitchTip
    echo "â³ ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° GlitchTip..."
    sleep 30
    
    # ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÐ¼ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
    if docker-compose exec -T glitchtip ./manage.py migrate > /dev/null 2>&1; then
        echo "âœ… ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ GlitchTip Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ñ‹"
    else
        echo "âš ï¸ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ GlitchTip"
    fi
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    if docker-compose exec -T glitchtip ./manage.py createsuperuser --noinput > /dev/null 2>&1; then
        echo "âœ… Ð¡ÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ GlitchTip ÑÐ¾Ð·Ð´Ð°Ð½"
    else
        echo "âš ï¸ Ð¡ÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚"
    fi
    
    echo "âœ… GlitchTip Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½"
    echo "ðŸŒ ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ http://localhost:9000 Ð´Ð»Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Grafana
setup_grafana() {
    echo "ðŸ“Š ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Grafana..."
    
    # Ð–Ð´ÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÐºÐ° Grafana
    echo "â³ ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° Grafana..."
    sleep 20
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Grafana
    if curl -f http://localhost:3000/api/health > /dev/null 2>&1; then
        echo "âœ… Grafana Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð°"
    else
        echo "âŒ Grafana Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»Ð°ÑÑŒ"
        return 1
    fi
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ datasource Ð´Ð»Ñ Prometheus
    cat > grafana/provisioning/datasources/prometheus.yml << EOF
apiVersion: 1

datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: true
EOF
    
    echo "âœ… Datasource Prometheus Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Alertmanager
setup_alertmanager() {
    echo "ðŸ”” ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Alertmanager..."
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð»Ñ Telegram
    if grep -q "TELEGRAM_BOT_TOKEN" .env && grep -q "TELEGRAM_CHAT_ID" .env; then
        echo "âœ… ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Telegram Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹"
    else
        echo "âš ï¸ ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Telegram Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹"
        echo "ðŸ“ Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² .env:"
        echo "TELEGRAM_BOT_TOKEN=your_bot_token"
        echo "TELEGRAM_CHAT_ID=your_chat_id"
    fi
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Alertmanager
    if curl -f http://localhost:9093/api/v1/status > /dev/null 2>&1; then
        echo "âœ… Alertmanager Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½"
    else
        echo "âŒ Alertmanager Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»ÑÑ"
        return 1
    fi
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¼ÐµÑ‚Ñ€Ð¸Ðº
check_metrics() {
    echo "ðŸ“ˆ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¼ÐµÑ‚Ñ€Ð¸Ðº..."
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Prometheus
    if curl -f http://localhost:9090/api/v1/status/targets > /dev/null 2>&1; then
        echo "âœ… Prometheus Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"
    else
        echo "âŒ Prometheus Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½"
        return 1
    fi
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð±Ð¾Ñ‚Ð°
    if curl -f http://localhost:8080/metrics > /dev/null 2>&1; then
        echo "âœ… ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð±Ð¾Ñ‚Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹"
    else
        echo "âŒ ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð±Ð¾Ñ‚Ð° Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹"
        return 1
    fi
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ health check
    if curl -f http://localhost:8080/healthz > /dev/null 2>&1; then
        echo "âœ… Health check Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"
    else
        echo "âŒ Health check Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½"
        return 1
    fi
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ð°
create_dashboard() {
    echo "ðŸ“Š Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ð°..."
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´
    cat > grafana/provisioning/dashboards/schoolbot.json << EOF
{
  "dashboard": {
    "id": null,
    "title": "SchoolBot Dashboard",
    "tags": ["schoolbot", "telegram"],
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "Requests per Second",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(bot_requests_total[5m])",
            "legendFormat": "req/s"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
      },
      {
        "id": 2,
        "title": "Errors per Second",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(bot_errors_total[5m])",
            "legendFormat": "errors/s"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
      },
      {
        "id": 3,
        "title": "95th Percentile Latency",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(bot_latency_seconds_bucket[5m]))",
            "legendFormat": "p95"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
      },
      {
        "id": 4,
        "title": "Open Tickets",
        "type": "stat",
        "targets": [
          {
            "expr": "bot_tickets_open",
            "legendFormat": "tickets"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
      }
    ],
    "time": {"from": "now-1h", "to": "now"},
    "refresh": "10s"
  }
}
EOF
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ð¾Ð²
    cat > grafana/provisioning/dashboards/dashboards.yml << EOF
apiVersion: 1

providers:
  - name: 'default'
    orgId: 1
    folder: ''
    type: file
    disableDeletion: false
    updateIntervalSeconds: 10
    allowUiUpdates: true
    options:
      path: /etc/grafana/provisioning/dashboards
EOF
    
    echo "âœ… Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ ÑÐ¾Ð·Ð´Ð°Ð½"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸
final_check() {
    echo "âœ… Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°..."
    
    echo ""
    echo "ðŸ“Š Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹:"
    echo "- ðŸŒ Grafana: http://localhost:3000 (admin/admin123)"
    echo "- ðŸ“ˆ Prometheus: http://localhost:9090"
    echo "- ðŸ”” Alertmanager: http://localhost:9093"
    echo "- ðŸ¤– Bot Health: http://localhost:8080/healthz"
    echo "- ðŸ“Š Bot Metrics: http://localhost:8080/metrics"
    echo "- ðŸ› GlitchTip: http://localhost:9000"
    
    echo ""
    echo "ðŸ“‹ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
    echo "1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Grafana Ð¸ Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð¿Ð¾Ð´ admin/admin123"
    echo "2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ GlitchTip Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð² http://localhost:9000"
    echo "3. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ GLITCHTIP_DSN Ð² .env"
    echo "4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Telegram ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð² .env"
    echo "5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð°Ð»ÐµÑ€Ñ‚Ñ‹ Ð² Alertmanager"
    
    echo ""
    echo "ðŸŽ‰ Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°!"
}

# ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ
main() {
    echo "ðŸ“‹ ÐŸÐ»Ð°Ð½ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸:"
    echo "1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹"
    echo "2. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹"
    echo "3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ"
    echo "4. Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²"
    echo "5. Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ GlitchTip"
    echo "6. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Grafana"
    echo "7. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Alertmanager"
    echo "8. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¼ÐµÑ‚Ñ€Ð¸Ðº"
    echo "9. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ð°"
    echo "10. Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°"
    echo ""
    
    check_dependencies
    create_directories
    setup_environment
    start_services
    init_glitchtip
    setup_grafana
    setup_alertmanager
    check_metrics
    create_dashboard
    final_check
}

# Ð—Ð°Ð¿ÑƒÑÐº Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ°
main "$@" 