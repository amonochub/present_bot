#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã SchoolBot –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/server_check.sh

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã SchoolBot –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
echo "üì° –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
if ping -c 1 89.169.38.246 > /dev/null 2>&1; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    exit 1
fi

# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
echo "üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:"
echo ""
echo "1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É:"
echo "   ssh root@89.169.38.246"
echo ""
echo "2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–æ–≤:"
echo "   systemctl status schoolbot*"
echo ""
echo "3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –±–æ—Ç–æ–≤:"
echo "   journalctl -u schoolbot -f"
echo "   journalctl -u schoolbot2 -f"
echo "   journalctl -u schoolbot3 -f"
echo ""
echo "4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
echo "   ps aux | grep python"
echo "   ps aux | grep schoolbot"
echo ""
echo "5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤:"
echo "   netstat -tlnp | grep :8081"
echo "   netstat -tlnp | grep :8082"
echo "   netstat -tlnp | grep :8083"
echo ""
echo "6. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
echo "   docker ps"
echo "   docker logs schoolbot"
echo ""
echo "7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:"
echo "   docker exec -it postgres psql -U schoolbot -d schoolbot -c 'SELECT COUNT(*) FROM users;'"
echo ""
echo "8. –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis:"
echo "   docker exec -it redis redis-cli ping"
echo "   docker exec -it redis redis-cli info"
echo ""
echo "9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:"
echo "   curl http://localhost:8081/health"
echo "   curl http://localhost:8082/health"
echo "   curl http://localhost:8083/health"
echo ""
echo "10. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫:"
echo "    curl http://localhost:8081/metrics"
echo "    curl http://localhost:8082/metrics"
echo "    curl http://localhost:8083/metrics"
echo ""
echo "11. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏:"
echo "    htop"
echo "    iostat"
echo "    free -h"
echo ""
echo "12. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞:"
echo "    df -h"
echo "    du -sh /opt/schoolbot/*"
echo ""
echo "13. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:"
echo "    cat /opt/schoolbot/.env"
echo "    ls -la /opt/schoolbot/"
echo ""
echo "14. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–æ–≤:"
echo "    systemctl restart schoolbot"
echo "    systemctl restart schoolbot2"
echo "    systemctl restart schoolbot3"
echo ""
echo "15. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:"
echo "    systemctl is-enabled schoolbot"
echo "    systemctl is-enabled schoolbot2"
echo "    systemctl is-enabled schoolbot3"
echo ""
echo "16. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:"
echo "    ss -tlnp | grep :808"
echo "    lsof -i :8081"
echo "    lsof -i :8082"
echo "    lsof -i :8083"
echo ""
echo "17. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:"
echo "    tail -f /opt/schoolbot/logs/bot.log"
echo "    tail -f /opt/schoolbot/logs/error.log"
echo ""
echo "18. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:"
echo "    docker stats"
echo "    top -p \$(pgrep -f schoolbot)"
echo ""
echo "19. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π:"
echo "    ls -la /opt/schoolbot/backups/"
echo "    du -sh /opt/schoolbot/backups/"
echo ""
echo "20. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:"
echo "    cd /opt/schoolbot && git status"
echo "    cd /opt/schoolbot && git log --oneline -5"
echo ""
echo "üìä –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:"
echo "   watch -n 5 'systemctl status schoolbot*'"
echo "   watch -n 5 'ps aux | grep python | grep schoolbot'"
echo "   watch -n 5 'docker stats --no-stream'"
echo ""
echo "üîß –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏:"
echo "   nano /etc/nginx/sites-available/schoolbot"
echo "   systemctl reload nginx"
echo "   nginx -t"
echo ""
echo "üìà –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ—Ç—Ä–∏–∫ Grafana:"
echo "   http://89.169.38.246:3000"
echo "   –õ–æ–≥–∏–Ω: admin"
echo "   –ü–∞—Ä–æ–ª—å: admin"
echo ""
echo "üìä –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ—Ç—Ä–∏–∫ Prometheus:"
echo "   http://89.169.38.246:9090"
echo ""
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" 