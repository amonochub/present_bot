# üîí –û—Ç—á—ë—Ç –ø–æ –∞—É–¥–∏—Ç—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ School Bot

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ê—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à—ë–Ω

–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è: $(date)

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–ò–°–ü–†–ê–í–õ–ï–ù–´)

### 1. **–£—Ç–µ—á–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞**: –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ñ–∞–π–ª–∞—Ö `.env` –∏ `.env.backup`
- **TELEGRAM_TOKEN**: `8152775753:AAHJDIYZTutzSvti9OHCaBJU897kOtCx1nM`
- **ADMIN_IDS**: `1570881,64210389`

**–î–µ–π—Å—Ç–≤–∏—è**:
- ‚úÖ –£–¥–∞–ª—ë–Ω —Ñ–∞–π–ª `.env.backup` –∏–∑ git
- ‚úÖ –°–æ–∑–¥–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —à–∞–±–ª–æ–Ω `env.example`
- ‚úÖ –§–∞–π–ª—ã `.env*` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- üîÑ **–ù–ï–ú–ï–î–õ–ï–ù–ù–û** —Å–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —É @BotFather
- üîÑ **–ù–ï–ú–ï–î–õ–ï–ù–ù–û** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- üîÑ –û–±–Ω–æ–≤–∏—Ç—å ADMIN_IDS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### 2. **–£—è–∑–≤–∏–º–æ—Å—Ç—å –≤ sentry-sdk** ‚ö†Ô∏è –°–†–ï–î–ù–Ø–Ø
**–ü—Ä–æ–±–ª–µ–º–∞**: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç—å GHSA-g92j-qhmh-64v2 –≤ sentry-sdk 2.4.0

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –¥–æ `sentry-sdk>=2.8.0`
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `requirements.txt`

## ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 1. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞** ‚úÖ
**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**: Bandit
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 0 –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞–π–¥–µ–Ω–æ
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ 3693 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `app/`
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö, —Å—Ä–µ–¥–Ω–∏—Ö –∏ –Ω–∏–∑–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ

### 2. **–ê—É–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** ‚úÖ
**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**: pip-audit
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 1 —É—è–∑–≤–∏–º–æ—Å—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ sentry-sdk —Å 2.4.0 –¥–æ 2.34.1

### 3. **CSRF –∑–∞—â–∏—Ç–∞** ‚úÖ
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `app/middlewares/csrf.py`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ nonce —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è callback –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

### 4. **Rate Limiting** ‚úÖ
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `app/middlewares/rate_limit.py`
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 20 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS –∞—Ç–∞–∫
- ‚úÖ –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 5. **–†–æ–ª–µ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚úÖ
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: `app/roles.py`
- ‚úÖ –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π (student, teacher, parent, director, admin)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–æ–ª—è–º–∏

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**
```bash
# 1. –°–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
# –ü–µ—Ä–µ–π—Ç–∏ –∫ @BotFather –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω

# 2. –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª
TELEGRAM_TOKEN=–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
ADMIN_IDS=–≤–∞—à–∏_–Ω–æ–≤—ã–µ_id

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
```

### 2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
```yaml
# .github/workflows/security.yml
name: Security Audit
on: [push, pull_request]
jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Bandit
        run: |
          pip install bandit
          bandit -r app/ -f json -o bandit-report.json
      - name: Run pip-audit
        run: |
          pip install pip-audit
          pip-audit
```

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ app/services/security_monitor.py
import logging
from typing import Dict, Any

class SecurityMonitor:
    def __init__(self):
        self.logger = logging.getLogger(__name__)
    
    def log_suspicious_activity(self, user_id: int, action: str, details: Dict[str, Any]):
        self.logger.warning(f"Suspicious activity: user={user_id}, action={action}, details={details}")
```

### 4. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
- üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS –¥–ª—è webhook
- üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ
- üîê –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- üîê –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—É–¥–∏—Ç–∞

### –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **–§–∞–π–ª—ã –∫–æ–¥–∞**: 50+ —Ñ–∞–π–ª–æ–≤ Python
- **–°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞**: 3693 —Å—Ç—Ä–æ–∫–∏
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: 27 –ø–∞–∫–µ—Ç–æ–≤
- **Middleware**: 7 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ **0 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π** –≤ –∫–æ–¥–µ
- ‚úÖ **1 —É—è–∑–≤–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚ö†Ô∏è **1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞** —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ **CSRF –∑–∞—â–∏—Ç–∞** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ **Rate limiting** –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ **–†–æ–ª–µ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** —Ä–∞–±–æ—Ç–∞–µ—Ç

## üéØ –ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

### –ù–µ–¥–µ–ª—è 1:
- [ ] –°–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å CI/CD –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ù–µ–¥–µ–ª—è 2:
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS –¥–ª—è webhook
- [ ] –î–æ–±–∞–≤–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –∞—É–¥–∏—Ç—ã

### –ù–µ–¥–µ–ª—è 3:
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìã –ß–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- [x] –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—è–∑–≤–∏–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [x] –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
- [x] –ê—É–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ CSRF –∑–∞—â–∏—Ç—ã
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ Rate Limiting
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### üîÑ –¢—Ä–µ–±—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- [ ] –°–º–µ–Ω–∞ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS
- [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –±–∞–∑–æ–≤—É—é –∑–∞—â–∏—Ç—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- ‚úÖ CSRF –∑–∞—â–∏—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –†–æ–ª–µ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–æ–¥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

**–ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –£—Ç–µ—á–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–ê)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–º–µ–Ω–∞ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞

---

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞**: $(date)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à—ë–Ω, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 