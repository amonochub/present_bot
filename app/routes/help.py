"""
–•—ç–Ω–¥–ª–µ—Ä –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /help
"""

import logging
from typing import Optional

from aiogram import F, Router
from aiogram.filters import Command
from aiogram.types import CallbackQuery, InlineKeyboardButton, InlineKeyboardMarkup, Message
from sqlalchemy import select

from app.db.session import AsyncSessionLocal
from app.db.user import User
from app.i18n import t
from app.repositories.user_repo import get_user
from app.roles import UserRole

router = Router()
logger = logging.getLogger(__name__)


# helper: get current user role
async def get_user_role(tg_id: int) -> Optional[str]:
    async with AsyncSessionLocal() as s:
        user = await s.scalar(select(User).where(User.tg_id == tg_id))
        return user.role if user else None


@router.message(Command("help"))
async def help_command(message: Message) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—É—é —Å–ø—Ä–∞–≤–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    
    if not message.from_user:
        await message.answer("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
        return

    user = await get_user(message.from_user.id)

    if not user:
        # –°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        help_text = t("help.help_unauthorized")

        keyboard = InlineKeyboardMarkup(
            inline_keyboard=[
                [InlineKeyboardButton(text=t("help.help_start_button"), callback_data="help:start")]
            ]
        )

    else:
        # –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        help_text = get_role_help(UserRole(user.role))
        keyboard = get_role_help_keyboard(UserRole(user.role))

    await message.answer(help_text, reply_markup=keyboard, parse_mode="HTML")


def get_role_help(role: UserRole) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–æ–ª–∏"""

    help_texts = {
        UserRole.STUDENT: """
üë®‚Äçüéì **–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è —É—á–µ–Ω–∏–∫–∞**

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
‚Ä¢ /tasks - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–∏—Ö –∑–∞–¥–∞–Ω–∏–π
‚Ä¢ /notes - –≤–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏
‚Ä¢ /ask - –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å —É—á–∏—Ç–µ–ª—é
‚Ä¢ /ticket - —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
‚Ä¢ üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞–Ω–∏–π –æ—Ç —É—á–∏—Ç–µ–ª–µ–π
‚Ä¢ üìù –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫
‚Ä¢ ‚ùì –ó–∞–¥–∞–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ —É—á–∏—Ç–µ–ª—è–º
‚Ä¢ üõ† –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–º–µ—Ç–∫–∏ –¥–ª—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚Ä¢ –ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã —É—á–∏—Ç–µ–ª—è–º
        """,
        UserRole.TEACHER: """
üë©‚Äçüè´ **–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è —É—á–∏—Ç–µ–ª—è**

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
‚Ä¢ /notes - –≤–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏ –æ —É—á–µ–Ω–∏–∫–∞—Ö
‚Ä¢ /addnote - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É
‚Ä¢ /ticket - —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ IT-–æ—Ç–¥–µ–ª
‚Ä¢ /students - —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
‚Ä¢ üìù –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫ –æ —É—á–µ–Ω–∏–∫–∞—Ö
‚Ä¢ üõ† –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É
‚Ä¢ üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —É—á–µ–Ω–∏–∫–æ–≤
‚Ä¢ üìä –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–º–µ—Ç–∫–∏ –æ —É—á–µ–Ω–∏–∫–∞—Ö
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞—è–≤–∫–∏ –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
‚Ä¢ –í–µ–¥–∏—Ç–µ —É—á–µ—Ç —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ —É—á–µ–Ω–∏–∫–æ–≤
        """,
        UserRole.PARENT: """
üë™ **–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è**

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
‚Ä¢ /tasks - –∑–∞–¥–∞–Ω–∏—è –≤–∞—à–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞
‚Ä¢ /cert - –∑–∞–∫–∞–∑ —Å–ø—Ä–∞–≤–æ–∫
‚Ä¢ /progress - —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å —Ä–µ–±–µ–Ω–∫–∞
‚Ä¢ /ticket - —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
‚Ä¢ üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞–Ω–∏–π —Ä–µ–±–µ–Ω–∫–∞
‚Ä¢ üìÑ –ó–∞–∫–∞–∑ PDF-—Å–ø—Ä–∞–≤–æ–∫
‚Ä¢ üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
‚Ä¢ üõ† –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è —Ä–µ–±–µ–Ω–∫–∞
‚Ä¢ –ó–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å–ø—Ä–∞–≤–∫–∏ –∑–∞—Ä–∞–Ω–µ–µ
‚Ä¢ –°–ª–µ–¥–∏—Ç–µ –∑–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å—é
        """,
        UserRole.PSYCHOLOGIST: """
üßë‚Äç‚öïÔ∏è **–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∞**

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
‚Ä¢ /inbox - –≤—Ö–æ–¥—è—â–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è
‚Ä¢ /requests - –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
‚Ä¢ /schedule - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
‚Ä¢ üì• –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π
‚Ä¢ üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
‚Ä¢ üìÖ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–µ—á
‚Ä¢ üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–æ–≤—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è
‚Ä¢ –°–æ–±–ª—é–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ –í–µ–¥–∏—Ç–µ —É—á–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
        """,
        UserRole.ADMIN: """
üèõ **–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
‚Ä¢ /tickets - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏
‚Ä¢ /broadcast - –º–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏
‚Ä¢ /users - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚Ä¢ /stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
‚Ä¢ üõ† –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚Ä¢ üì¢ –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫
‚Ä¢ üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚Ä¢ üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –ë—ã—Å—Ç—Ä–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∑–∞—è–≤–∫–∏
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –¥–ª—è –≤–∞–∂–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚Ä¢ –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Å–∏—Å—Ç–µ–º—ã
        """,
        UserRole.DIRECTOR: """
üìà **–°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞**

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
‚Ä¢ /kpi - –∫–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
‚Ä¢ /stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∫–æ–ª—ã
‚Ä¢ /reports - –æ—Ç—á–µ—Ç—ã
‚Ä¢ /tasks - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
‚Ä¢ üìä –ü—Ä–æ—Å–º–æ—Ç—Ä KPI —à–∫–æ–ª—ã
‚Ä¢ üìà –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚Ä¢ üìã –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤
‚Ä¢ üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ KPI
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç—á–µ—Ç—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
‚Ä¢ –°—Ç–∞–≤—å—Ç–µ –∑–∞–¥–∞—á–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
        """,
    }

    return help_texts.get(
        role,
        """
‚ùì **–û–±—â–∞—è —Å–ø—Ä–∞–≤–∫–∞**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /start –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º.
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏ –ø–æ –≤–∞—à–µ–π —Ä–æ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help.
        """,
    ).strip()


def get_role_help_keyboard(role: UserRole) -> InlineKeyboardMarkup:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å–ø—Ä–∞–≤–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–æ–ª–∏"""

    role_keyboards = {
        UserRole.STUDENT: [
            [
                InlineKeyboardButton(
                    text=t("help.help_student_tasks"), callback_data="help:student:tasks"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_student_notes"), callback_data="help:student:notes"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_student_ask"), callback_data="help:student:ask"
                )
            ],
        ],
        UserRole.TEACHER: [
            [
                InlineKeyboardButton(
                    text=t("help.help_teacher_notes"), callback_data="help:teacher:notes"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_teacher_tickets"), callback_data="help:teacher:tickets"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_teacher_students"), callback_data="help:teacher:students"
                )
            ],
        ],
        UserRole.PARENT: [
            [
                InlineKeyboardButton(
                    text=t("help.help_parent_tasks"), callback_data="help:parent:tasks"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_parent_certs"), callback_data="help:parent:certs"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_parent_progress"), callback_data="help:parent:progress"
                )
            ],
        ],
        UserRole.PSYCHOLOGIST: [
            [
                InlineKeyboardButton(
                    text=t("help.help_psych_inbox"), callback_data="help:psych:inbox"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_psych_requests"), callback_data="help:psych:requests"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_psych_schedule"), callback_data="help:psych:schedule"
                )
            ],
        ],
        UserRole.ADMIN: [
            [
                InlineKeyboardButton(
                    text=t("help.help_admin_tickets"), callback_data="help:admin:tickets"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_admin_broadcast"), callback_data="help:admin:broadcast"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_admin_stats"), callback_data="help:admin:stats"
                )
            ],
        ],
        UserRole.DIRECTOR: [
            [
                InlineKeyboardButton(
                    text=t("help.help_director_kpi"), callback_data="help:director:kpi"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_director_stats"), callback_data="help:director:stats"
                )
            ],
            [
                InlineKeyboardButton(
                    text=t("help.help_director_reports"), callback_data="help:director:reports"
                )
            ],
        ],
    }

    keyboard = role_keyboards.get(role, [])
    keyboard.append(
        [InlineKeyboardButton(text=t("help.help_main_menu_button"), callback_data="menu:main")]
    )

    return InlineKeyboardMarkup(inline_keyboard=keyboard)


@router.callback_query(F.data.startswith("help:"))
async def handle_help_callback(callback: CallbackQuery) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ —Å–ø—Ä–∞–≤–∫–∏"""

    data = callback.data.split(":")

    if data[1] == "start":
        # –í–æ–∑–≤—Ä–∞—Ç –∫ –Ω–∞—á–∞–ª—É
        await callback.message.edit_text(t("help.help_start_message"), parse_mode="HTML")
    elif data[1] == "back":
        # –í–æ–∑–≤—Ä–∞—Ç –∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø—Ä–∞–≤–∫–µ
        user = await get_user(callback.from_user.id)
        if user:
            help_text = get_role_help(user.role)
            keyboard = get_role_help_keyboard(user.role)
            await callback.message.edit_text(help_text, reply_markup=keyboard, parse_mode="HTML")
        else:
            await callback.message.edit_text(t("help.help_login_required"), parse_mode="HTML")
    else:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–ø—Ä–∞–≤–∫—É –ø–æ —Ä–∞–∑–¥–µ–ª—É
        role = data[1]
        section = data[2] if len(data) > 2 else None

        detail_text = get_detailed_help(role, section)

        keyboard = InlineKeyboardMarkup(
            inline_keyboard=[
                [InlineKeyboardButton(text=t("help.help_back_button"), callback_data="help:back")],
                [
                    InlineKeyboardButton(
                        text=t("help.help_main_menu_button"), callback_data="menu:main"
                    )
                ],
            ]
        )

        await callback.message.edit_text(detail_text, reply_markup=keyboard, parse_mode="HTML")

    await callback.answer()


def get_detailed_help(role: str, section: str) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–ø—Ä–∞–≤–∫—É –ø–æ —Ä–∞–∑–¥–µ–ª—É"""

    help_details = {
        "student": {
            "tasks": """
üìã **–ó–∞–¥–∞–Ω–∏—è –¥–ª—è —É—á–µ–Ω–∏–∫–∞**

**–ö–∞–∫ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ó–∞–¥–∞–Ω–∏—è" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞
3. –ò–∑—É—á–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–¢–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π:**
‚Ä¢ üìù –î–æ–º–∞—à–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
‚Ä¢ üß™ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
‚Ä¢ üìä –ü—Ä–æ–µ–∫—Ç—ã
‚Ä¢ üìö –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
‚Ä¢ –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –≤ —Å—Ä–æ–∫
‚Ä¢ –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ
            """,
            "notes": """
üìù **–ó–∞–º–µ—Ç–∫–∏ —É—á–µ–Ω–∏–∫–∞**

**–ö–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìù –ó–∞–º–µ—Ç–∫–∏" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É"
3. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏
4. –ù–∞–∂–º–∏—Ç–µ "‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

**–î–ª—è —á–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
‚Ä¢ üìö –ó–∞–ø–∏—Å–∏ —Å —É—Ä–æ–∫–æ–≤
‚Ä¢ üìã –°–ø–∏—Å–æ–∫ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π
‚Ä¢ üí° –í–∞–∂–Ω—ã–µ –∏–¥–µ–∏ –∏ –º—ã—Å–ª–∏
‚Ä¢ üìÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –î–µ–ª–∞–π—Ç–µ –∑–∞–º–µ—Ç–∫–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Ä–æ–∫–∞
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–º–µ—Ç–∫–∏
            """,
            "ask": """
‚ùì **–í–æ–ø—Ä–æ—Å—ã —É—á–∏—Ç–µ–ª—é**

**–ö–∞–∫ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚ùì –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏–ª–∏ —É—á–∏—Ç–µ–ª—è
3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å
4. –ù–∞–∂–º–∏—Ç–µ "üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å"

**–¢–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤:**
‚Ä¢ üìö –ü–æ –º–∞—Ç–µ—Ä–∏–∞–ª—É —É—Ä–æ–∫–∞
‚Ä¢ üìù –ü–æ –¥–æ–º–∞—à–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é
‚Ä¢ üß™ –ü–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ
‚Ä¢ üìä –ü–æ –ø—Ä–æ–µ–∫—Ç—É

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –§–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ç–∫–æ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ
‚Ä¢ –ü—Ä–∏–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ —Ñ–æ—Ç–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
‚Ä¢ –ë—É–¥—å—Ç–µ –≤–µ–∂–ª–∏–≤—ã –∏ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω—ã
            """,
        },
        "teacher": {
            "notes": """
üìù **–ó–∞–º–µ—Ç–∫–∏ –æ —É—á–µ–Ω–∏–∫–∞—Ö**

**–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìù –ó–∞–º–µ—Ç–∫–∏" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É"
3. –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
4. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏
5. –ù–∞–∂–º–∏—Ç–µ "‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

**–¢–∏–ø—ã –∑–∞–º–µ—Ç–æ–∫:**
‚Ä¢ üìö –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É
‚Ä¢ üéØ –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–∫–∞—Ö
‚Ä¢ üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —É—á–µ–Ω–∏–∫–∞
‚Ä¢ üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –î–µ–ª–∞–π—Ç–µ –∑–∞–º–µ—Ç–∫–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ
‚Ä¢ –ë—É–¥—å—Ç–µ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã –≤ –æ—Ü–µ–Ω–∫–∞—Ö
‚Ä¢ –û—Ç–º–µ—á–∞–π—Ç–µ –∫–∞–∫ —É—Å–ø–µ—Ö–∏, —Ç–∞–∫ –∏ –ø—Ä–æ–±–ª–µ–º—ã
            """,
            "tickets": """
üõ† **–ó–∞—è–≤–∫–∏ –≤ IT-–æ—Ç–¥–µ–ª**

**–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üõ† –ó–∞—è–≤–∫–∞" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã
3. –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥—Ä–æ–±–Ω–æ
4. –ù–∞–∂–º–∏—Ç–µ "üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å"

**–¢–∏–ø—ã –ø—Ä–æ–±–ª–µ–º:**
‚Ä¢ üíª –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º
‚Ä¢ üì± –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
‚Ä¢ üåê –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
‚Ä¢ üì∫ –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–µ–∫—Ç–æ—Ä–æ–º

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ
‚Ä¢ –£–∫–∞–∂–∏—Ç–µ, –∫–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞
‚Ä¢ –ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
            """,
            "students": """
üë• **–ú–æ–∏ —É—á–µ–Ω–∏–∫–∏**

**–ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üë• –£—á–µ–Ω–∏–∫–∏" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –∏–ª–∏ –≥—Ä—É–ø–ø—É
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —É—á–µ–Ω–∏–∫–µ:**
‚Ä¢ üìö –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º
‚Ä¢ üìù –í–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏ –æ —É—á–µ–Ω–∏–∫–µ
‚Ä¢ üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
‚Ä¢ üí¨ –ö–æ–Ω—Ç–∞–∫—Ç—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
‚Ä¢ –û—Ç–º–µ—á–∞–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
‚Ä¢ –°–≤—è–∑—ã–≤–∞–π—Ç–µ—Å—å —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
            """,
        },
        "parent": {
            "tasks": """
üìã **–ó–∞–¥–∞–Ω–∏—è —Ä–µ–±–µ–Ω–∫–∞**

**–ö–∞–∫ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ó–∞–¥–∞–Ω–∏—è" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –µ–≥–æ –∑–∞–¥–∞–Ω–∏—è

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞–Ω–∏—è—Ö:**
‚Ä¢ üìù –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
‚Ä¢ üìÖ –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚Ä¢ üìä –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚Ä¢ üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å, –∑–∞–¥–∞–≤—à–∏–π —Ä–∞–±–æ—Ç—É

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
‚Ä¢ –ü–æ–º–æ–≥–∞–π—Ç–µ —Ä–µ–±–µ–Ω–∫—É —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
‚Ä¢ –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å—Ä–æ–∫–∞–º–∏ —Å–¥–∞—á–∏
            """,
            "certs": """
üìÑ **–ó–∞–∫–∞–∑ —Å–ø—Ä–∞–≤–æ–∫**

**–ö–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìÑ –°–ø—Ä–∞–≤–∫–∏" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–ø—Ä–∞–≤–∫–∏
3. –£–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–∏–æ–¥
4. –ù–∞–∂–º–∏—Ç–µ "üì§ –ó–∞–∫–∞–∑–∞—Ç—å"

**–¢–∏–ø—ã —Å–ø—Ä–∞–≤–æ–∫:**
‚Ä¢ üìä –°–ø—Ä–∞–≤–∫–∞ –æ–± —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
‚Ä¢ üìÖ –°–ø—Ä–∞–≤–∫–∞ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
‚Ä¢ üè• –°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –≤—Ä–∞—á–∞
‚Ä¢ üéì –°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –ó–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å–ø—Ä–∞–≤–∫–∏ –∑–∞—Ä–∞–Ω–µ–µ
‚Ä¢ –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ—á–Ω—ã–π –ø–µ—Ä–∏–æ–¥
‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å–ø—Ä–∞–≤–∫–∏
            """,
            "progress": """
üìà **–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å —Ä–µ–±–µ–Ω–∫–∞**

**–ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìà –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±–µ–Ω–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏–ª–∏ –ø–µ—Ä–∏–æ–¥

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏:**
‚Ä¢ üìä –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º
‚Ä¢ üìù –û—Ü–µ–Ω–∫–∏ –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ
‚Ä¢ üìÖ –ì—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
‚Ä¢ üë®‚Äçüè´ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É—á–∏—Ç–µ–ª–µ–π

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å
‚Ä¢ –û–±—Å—É–∂–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–µ–±–µ–Ω–∫–æ–º
‚Ä¢ –°–≤—è–∑—ã–≤–∞–π—Ç–µ—Å—å —Å —É—á–∏—Ç–µ–ª—è–º–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
            """,
        },
        "psychologist": {
            "inbox": """
üì• **–í—Ö–æ–¥—è—â–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è**

**–ö–∞–∫ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì• –û–±—Ä–∞—â–µ–Ω–∏—è" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ
3. –ò–∑—É—á–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç—å—Ç–µ

**–¢–∏–ø—ã –æ–±—Ä–∞—â–µ–Ω–∏–π:**
‚Ä¢ üÜò –°—Ä–æ—á–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è
‚Ä¢ üí¨ –û–±—ã—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
‚Ä¢ üÜï –ù–æ–≤—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è
‚Ä¢ üìã –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–æ–≤—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è
‚Ä¢ –û—Ç–≤–µ—á–∞–π—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
‚Ä¢ –°–æ–±–ª—é–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
            """,
            "requests": """
üìã **–ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é**

**–ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å–∞–º–∏:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ó–∞–ø—Ä–æ—Å—ã" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
3. –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. –ù–∞–∑–Ω–∞—á—å—Ç–µ –≤—Ä–µ–º—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

**–¢–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**
‚Ä¢ üë®‚Äçüéì –û—Ç —É—á–µ–Ω–∏–∫–æ–≤
‚Ä¢ üë™ –û—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π
‚Ä¢ üë©‚Äçüè´ –û—Ç —É—á–∏—Ç–µ–ª–µ–π
‚Ä¢ üÜï –ù–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –ë—ã—Å—Ç—Ä–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
‚Ä¢ –£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Å—Ä–æ—á–Ω–æ—Å—Ç—å
‚Ä¢ –í–µ–¥–∏—Ç–µ —É—á–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
            """,
            "schedule": """
üìÖ **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π**

**–ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏
3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
4. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å—Ç—Ä–µ—á–∞—Ö:**
‚Ä¢ üë§ –ö–ª–∏–µ–Ω—Ç
‚Ä¢ üìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
‚Ä¢ ‚è± –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ üìù –¢–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –í–µ–¥–∏—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–π—Ç–µ –æ –≤—Å—Ç—Ä–µ—á–∞—Ö –∑–∞—Ä–∞–Ω–µ–µ
‚Ä¢ –ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
            """,
        },
        "admin": {
            "tickets": """
üõ† **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏**

**–ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞—è–≤–∫–∏:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üõ† –ó–∞—è–≤–∫–∏" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
3. –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞—è–≤–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

**–°—Ç–∞—Ç—É—Å—ã –∑–∞—è–≤–æ–∫:**
‚Ä¢ üÜï –ù–æ–≤—ã–µ
‚Ä¢ üîÑ –í —Ä–∞–±–æ—Ç–µ
‚Ä¢ ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
‚Ä¢ ‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –ë—ã—Å—Ç—Ä–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –∑–∞—è–≤–∫–∏
‚Ä¢ –û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å—Ç–∞—Ç—É—Å—ã —Ä–µ–≥—É–ª—è—Ä–Ω–æ
‚Ä¢ –°–≤—è–∑—ã–≤–∞–π—Ç–µ—Å—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
            """,
            "broadcast": """
üì¢ **–ú–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏**

**–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì¢ –†–∞—Å—Å—ã–ª–∫–∏" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ "‚ûï –ù–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞"
3. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
4. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
5. –ù–∞–∂–º–∏—Ç–µ "üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å"

**–¢–∏–ø—ã —Ä–∞—Å—Å—ã–ª–æ–∫:**
‚Ä¢ üì¢ –í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
‚Ä¢ üë®‚Äçüéì –¢–æ–ª—å–∫–æ —É—á–µ–Ω–∏–∫–∞–º
‚Ä¢ üë©‚Äçüè´ –¢–æ–ª—å–∫–æ —É—á–∏—Ç–µ–ª—è–º
‚Ä¢ üë™ –¢–æ–ª—å–∫–æ —Ä–æ–¥–∏—Ç–µ–ª—è–º

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –¥–ª—è –≤–∞–∂–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
‚Ä¢ –ù–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏
            """,
            "stats": """
üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã**

**–ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ

**–¢–∏–ø—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
‚Ä¢ üë• –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚Ä¢ üìù –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–º–µ—Ç–æ–∫
‚Ä¢ üõ† –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
‚Ä¢ üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Ç—Ä–µ–Ω–¥—ã
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
            """,
        },
        "director": {
            "kpi": """
üìà **–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**

**–ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å KPI:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìà KPI" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ KPI:**
‚Ä¢ üìä –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å —É—á–µ–Ω–∏–∫–æ–≤
‚Ä¢ üë®‚Äçüè´ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É—á–∏—Ç–µ–ª–µ–π
‚Ä¢ üìù –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–º–µ—Ç–æ–∫
‚Ä¢ üõ† –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ KPI
‚Ä¢ –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
            """,
            "stats": """
üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∫–æ–ª—ã**

**–ö–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ

**–¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤:**
‚Ä¢ üìà –û–±—â–∞—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å
‚Ä¢ üë• –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∞—Å—Å–∞–º
‚Ä¢ üë®‚Äçüè´ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É—á–∏—Ç–µ–ª–µ–π
‚Ä¢ üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚Ä¢ –î–µ–ª–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Å –∫–æ–ª–ª–µ–∫—Ç–∏–≤–æ–º
            """,
            "reports": """
üìã **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤**

**–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –û—Ç—á–µ—Ç—ã" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞
3. –£–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–∏–æ–¥
4. –ù–∞–∂–º–∏—Ç–µ "üì§ –°–æ–∑–¥–∞—Ç—å"

**–¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤:**
‚Ä¢ üìä –û—Ç—á–µ—Ç –æ–± —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
‚Ä¢ üë• –û—Ç—á–µ—Ç –ø–æ –∫–ª–∞—Å—Å–∞–º
‚Ä¢ üë®‚Äçüè´ –û—Ç—á–µ—Ç –ø–æ —É—á–∏—Ç–µ–ª—è–º
‚Ä¢ üìà –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç

**–°–æ–≤–µ—Ç—ã:**
‚Ä¢ –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –æ—Ç—á–µ—Ç—ã —Ä–µ–≥—É–ª—è—Ä–Ω–æ
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–∞–∂–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
            """,
        },
    }

    role_details = help_details.get(role, {})
    section_text = role_details.get(section, f"üìñ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ —Ä–∞–∑–¥–µ–ª—É {section}")

    return section_text.strip()


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ö–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞–≤–∫–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
@router.callback_query(F.data == "help")
async def help_button(call: CallbackQuery, lang: str) -> None:
    try:
        if call.from_user is None:
            await call.answer(t("help.help_user_not_found"), show_alert=True)
            return
        user_role = await get_user_role(call.from_user.id)
        if not user_role:
            await call.answer(t("help.help_please_login"), show_alert=True)
            return

        help_text = get_role_help(user_role)
        keyboard = get_role_help_keyboard(user_role)
        full_text = help_text + "\n\n" + get_faq_text(lang)
        if call.message is not None and hasattr(call.message, "edit_text"):
            await call.message.edit_text(full_text, reply_markup=keyboard)
            await call.answer(t("help.help_help_loaded"))
        else:
            await call.answer(t("help.help_help_loaded"))
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–ø—Ä–∞–≤–∫–∏: {e}")
        await call.answer(t("help.help_error_loading"), show_alert=True)


def get_faq_text(lang: str) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç FAQ —Ç–µ–∫—Å—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ"""

    faq_text = f"""
{t("help.help_faq_title")}

{t("help.help_faq_role_change")}

{t("help.help_faq_password")}

{t("help.help_faq_notifications")}

{t("help.help_faq_support")}
    """

    return faq_text.strip()


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
@router.message(Command("notes"))
async def teacher_notes_command(msg: Message, lang: str) -> None:
    """–ö–æ–º–∞–Ω–¥–∞ /notes –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π"""
    try:
        if msg.from_user is None:
            await msg.answer("–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.")
            return
        user = await get_user_role(msg.from_user.id)
        if not user or user not in ["teacher", "super"]:
            await msg.answer("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
            return

        # –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫
        await msg.answer(
            "üìù <b>–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</b>\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É ¬´üìù –ó–∞–º–µ—Ç–∫–∏¬ª –≤ –º–µ–Ω—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞."
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã /notes: {e}")
        await msg.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–æ–∫")


@router.message(Command("addnote"))
async def teacher_addnote_command(msg: Message, lang: str) -> None:
    """–ö–æ–º–∞–Ω–¥–∞ /addnote –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π"""
    try:
        if msg.from_user is None:
            await msg.answer("–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.")
            return
        user = await get_user_role(msg.from_user.id)
        if not user or user not in ["teacher", "super"]:
            await msg.answer("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
            return

        # –ü–∞—Ä—Å–∏–º –∫–æ–º–∞–Ω–¥—É: /addnote –ò–º—è –¢–µ–∫—Å—Ç
        if msg.text is None:
            await msg.answer("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /addnote –ò–º—è_—É—á–µ–Ω–∏–∫–∞ –¢–µ–∫—Å—Ç_–∑–∞–º–µ—Ç–∫–∏")
            return
        text = msg.text.replace("/addnote", "").strip()
        if not text:
            await msg.answer("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /addnote –ò–º—è_—É—á–µ–Ω–∏–∫–∞ –¢–µ–∫—Å—Ç_–∑–∞–º–µ—Ç–∫–∏")
            return

        # –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏
        await msg.answer(
            "‚úÖ –ó–∞–º–µ—Ç–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É¬ª –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è."
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã /addnote: {e}")
        await msg.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏")


@router.message(Command("ticket"))
async def teacher_ticket_command(msg: Message, lang: str) -> None:
    """–ö–æ–º–∞–Ω–¥–∞ /ticket –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π"""
    try:
        if msg.from_user is None:
            await msg.answer("–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.")
            return
        user = await get_user_role(msg.from_user.id)
        if not user or user not in ["teacher", "super"]:
            await msg.answer("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
            return

        # –ü–∞—Ä—Å–∏–º –∫–æ–º–∞–Ω–¥—É: /ticket –û–ø–∏—Å–∞–Ω–∏–µ
        if msg.text is None:
            await msg.answer("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /ticket –û–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–æ–±–ª–µ–º—ã")
            return
        text = msg.text.replace("/ticket", "").strip()
        if not text:
            await msg.answer("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /ticket –û–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–æ–±–ª–µ–º—ã")
            return

        # –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏
        await msg.answer(
            "‚úÖ IT-–∑–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É ¬´üõ† IT-–∑–∞—è–≤–∫–∏¬ª –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫."
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã /ticket: {e}")
        await msg.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏")
