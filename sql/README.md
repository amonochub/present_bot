# SQL Schema for SchoolBot

Эта папка содержит SQL-скрипты для инициализации базы данных SchoolBot.

## Файлы

### 01_init_schema.sql
Основная схема базы данных, включает:
- Создание всех таблиц
- Настройка индексов для производительности
- Триггеры для автоматического обновления временных меток
- Ограничения целостности данных

### 02_demo_data.sql
Демо-данные для тестирования:
- Тестовые пользователи всех ролей
- Примеры заметок, тикетов, запросов
- Демо-уведомления и рассылки

## Использование

### Ручная инициализация
```bash
# Подключение к PostgreSQL
psql -h localhost -U username -d database_name

# Выполнение скриптов
\i sql/01_init_schema.sql
\i sql/02_demo_data.sql
```

### Docker Compose
Скрипты автоматически выполняются при инициализации контейнера PostgreSQL.

### Alembic
Также можно использовать миграции Alembic:
```bash
alembic upgrade head
```

## Демо-пользователи

| Роль | Логин | Пароль | Описание |
|------|-------|--------|----------|
| admin | admin | admin123 | Администратор системы |
| director | director | dir123 | Директор школы |
| teacher1 | teacher1 | teach123 | Учитель математики |
| teacher2 | teacher2 | teach456 | Учитель истории |
| psych1 | psych1 | psych123 | Школьный психолог |
| parent1 | parent1 | parent123 | Родитель ученика |
| parent2 | parent2 | parent456 | Родитель ученика |
| student1 | student1 | stud123 | Ученик 7А класса |
| student2 | student2 | stud456 | Ученик 8Б класса |

## Структура БД

### Основные таблицы
- `users` - Пользователи системы
- `notes` - Заметки учителей
- `tickets` - Тикеты в техподдержку
- `psych_requests` - Запросы к психологу
- `media_requests` - Запросы на документы
- `tasks` - Задачи от администрации
- `broadcasts` - Рассылки
- `notifications` - Системные уведомления

### Индексы
Настроены индексы для оптимизации частых запросов:
- По ID пользователей
- По статусам заявок
- По ролям пользователей
- По непрочитанным уведомлениям

## Обновление схемы

При изменении моделей SQLAlchemy обновите соответствующие SQL-файлы:

1. Обновите `01_init_schema.sql`
2. При необходимости добавьте миграционный скрипт
3. Обновите демо-данные в `02_demo_data.sql`
