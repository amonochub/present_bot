# üöÄ DevOps Guide - SchoolBot

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é SchoolBot –≤ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å—Ä–µ–¥–µ.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
4. [–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ](#–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
5. [–ë—ç–∫–∞–ø—ã –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ](#–±—ç–∫–∞–ø—ã-–∏-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)
6. [–î–µ–ø–ª–æ–π](#–¥–µ–ø–ª–æ–π)
7. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
8. [Troubleshooting](#troubleshooting)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker 20.10+
- Docker Compose 2.0+
- 2GB RAM –º–∏–Ω–∏–º—É–º
- 10GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd SchoolBot

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
./scripts/init_monitoring.sh

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# Health check
curl http://localhost:8080/healthz

# –ú–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8080/metrics

# Grafana
open http://localhost:3000  # admin/admin123

# Prometheus
open http://localhost:9090
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram      ‚îÇ    ‚îÇ   SchoolBot     ‚îÇ    ‚îÇ   PostgreSQL    ‚îÇ
‚îÇ   Bot API       ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Aiogram)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Database      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ     Redis       ‚îÇ
                       ‚îÇ   (Cache/FSM)   ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Prometheus    ‚îÇ    ‚îÇ    Grafana      ‚îÇ    ‚îÇ  Alertmanager   ‚îÇ
‚îÇ   (Metrics)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Dashboards)  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  (Alerts)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ   GlitchTip     ‚îÇ
                       ‚îÇ  (Error Logs)   ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–µ—Ä–≤–∏—Å—ã Docker Compose

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------|------------|
| `bot` | 8080 | –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç + health check |
| `postgres` | 5432 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| `redis` | 6379 | –ö—ç—à –∏ FSM |
| `prometheus` | 9090 | –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ |
| `grafana` | 3000 | –î–∞—à–±–æ—Ä–¥—ã |
| `alertmanager` | 9093 | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `glitchtip` | 9000 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ |
| `nginx` | 80 | Load balancer (–ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏) |

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ Prometheus

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **`bot_requests_total`** - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- **`bot_errors_total`** - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- **`bot_latency_seconds`** - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **`bot_tickets_open`** - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫
- **`kpi_tasks_total`** - –í—Å–µ–≥–æ –ø–æ—Ä—É—á–µ–Ω–∏–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞
- **`kpi_tasks_done`** - –í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ—Ä—É—á–µ–Ω–∏–π
- **`kpi_tasks_overdue`** - –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –ø–æ—Ä—É—á–µ–Ω–∏–π

#### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

```promql
# –ó–∞–ø—Ä–æ—Å—ã –≤ —Å–µ–∫—É–Ω–¥—É
rate(bot_requests_total[5m])

# –û—à–∏–±–∫–∏ –≤ —Å–µ–∫—É–Ω–¥—É
rate(bot_errors_total[5m])

# 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
histogram_quantile(0.95, rate(bot_latency_seconds_bucket[5m]))

# –û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞—è–≤–∫–∏
bot_tickets_open

# –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
(kpi_tasks_done / kpi_tasks_total) * 100
```

### –ê–ª–µ—Ä—Ç—ã

#### –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã

| –ê–ª–µ—Ä—Ç | –£—Å–ª–æ–≤–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|-------|---------|----------|
| **HighErrorRate** | >3 –æ—à–∏–±–æ–∫ –∑–∞ 5 –º–∏–Ω | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| **TooManyOpenTickets** | >10 –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫ | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| **BotDown** | –ë–æ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω 30—Å | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |
| **HighLatency** | 95% > 2 —Å–µ–∫—É–Ω–¥ | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| **TooManyOverdueTasks** | >3 –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

1. **–°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞** —á–µ—Ä–µ–∑ @BotFather
2. **–î–æ–±–∞–≤—å—Ç–µ –≤ —á–∞—Ç/–∫–∞–Ω–∞–ª** –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. **–ü–æ–ª—É—á–∏—Ç–µ chat_id**:
   ```bash
   curl "https://api.telegram.org/bot<TOKEN>/getUpdates"
   ```
4. **–î–æ–±–∞–≤—å—Ç–µ –≤ .env**:
   ```env
   TELEGRAM_BOT_TOKEN=123456:ABC...
   TELEGRAM_CHAT_ID=-987654321
   ```

### –î–∞—à–±–æ—Ä–¥—ã Grafana

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –ø–∞–Ω–µ–ª–∏

- **Requests per Second** - –ì—Ä–∞—Ñ–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- **Errors per Second** - –ì—Ä–∞—Ñ–∏–∫ –æ—à–∏–±–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É
- **95th Percentile Latency** - 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
- **Open Tickets** - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫
- **Task Completion Rate** - –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

#### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana: http://localhost:3000
2. –õ–æ–≥–∏–Ω: `admin/admin123`
3. –î–∞—à–±–æ—Ä–¥ "SchoolBot Dashboard" —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –î–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏: Edit ‚Üí Export ‚Üí Save to file

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 3 —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
./scripts/scale.sh 3

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
docker stats
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```yaml
# docker-compose.override.yml
services:
  bot:
    deploy:
      replicas: 3
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
```

### Load Balancer

Nginx –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏:

```nginx
upstream bot_backend {
    least_conn;
    server bot:8080 max_fails=3 fail_timeout=30s;
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –õ–æ–≥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
docker-compose logs --tail=100 bot

# –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
curl http://localhost:8080/metrics
```

## üíæ –ë—ç–∫–∞–ø—ã –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
./scripts/backup.sh

# –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
ls -la backups/

# –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–æ–≤
du -sh backups/*
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
./scripts/restore.sh [backup_file]

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä
./scripts/restore.sh
```

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ crontab
echo "0 2 * * * /path/to/SchoolBot/scripts/backup.sh" | crontab -

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
crontab -l
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –±—ç–∫–∞–ø–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
pg_restore --list backup_file.sql

# –¢–µ—Å—Ç–æ–≤–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
pg_restore --dry-run backup_file.sql
```

## üöÄ –î–µ–ø–ª–æ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

```bash
# –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
./scripts/deploy.sh prod

# –î–µ–ø–ª–æ–π –≤ staging
./scripts/deploy.sh staging

# –î–µ–ø–ª–æ–π –±–µ–∑ —Ç–µ—Å—Ç–æ–≤
RUN_TESTS=false ./scripts/deploy.sh prod
```

### Zero-Downtime –¥–µ–ø–ª–æ–π

1. **–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞** —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
3. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. **Graceful restart** —Å–µ—Ä–≤–∏—Å–æ–≤
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### CI/CD Pipeline

```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run tests
        run: python3 -m pytest tests/
      - name: Security scan
        run: bandit -r app/
  
  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Deploy to production
        run: ./scripts/deploy.sh prod
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# Telegram Bot
TELEGRAM_TOKEN=your_bot_token_here

# Database
POSTGRES_DB=schoolbot
POSTGRES_USER=schoolbot
POSTGRES_PASSWORD=secure_password_here

# Redis
REDIS_URL=redis://redis:6379/0

# Monitoring
GLITCHTIP_DSN=http://PublicKey@glitchtip:8000/1
TELEGRAM_BOT_TOKEN=your_alert_bot_token
TELEGRAM_CHAT_ID=your_chat_id

# Application
ENVIRONMENT=prod
KEEP_DAYS=14
```

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```env
# Scaling
BOT_INSTANCE_ID=0
LOG_LEVEL=INFO

# Backup
BACKUP_BEFORE_DEPLOY=true
RUN_TESTS=true
NOTIFY_TELEGRAM=true
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–µ–∫—Ä–µ—Ç—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
grep -r "password\|token\|secret" . --exclude-dir=.git

# –†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
# 1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ BotFather
# 2. –û–±–Ω–æ–≤–∏—Ç–µ TELEGRAM_TOKEN –≤ .env
# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose restart bot
```

### –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
netstat -tlnp

# Firewall –ø—Ä–∞–≤–∏–ª–∞
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
docker-compose pull

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
docker-compose build --no-cache

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy image schoolbot_bot:latest
```

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–æ—Ç–æ–º

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8080/healthz

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
docker-compose restart bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram
curl "https://api.telegram.org/bot${TELEGRAM_TOKEN}/getMe"
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
docker-compose exec postgres pg_isready -U schoolbot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec bot python manage.py showmigrations

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec bot python manage.py migrate

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
docker-compose exec postgres psql -U schoolbot -d schoolbot -c "SELECT COUNT(*) FROM users;"
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus
curl http://localhost:9090/api/v1/status/targets

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Grafana
curl http://localhost:3000/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Alertmanager
curl http://localhost:9093/api/v1/status

# –ü—Ä–æ–≤–µ—Ä–∫–∞ GlitchTip
curl http://localhost:9000/health
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
curl http://localhost:8080/metrics

# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
docker-compose logs --tail=1000 bot | grep ERROR

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ Redis
docker-compose exec redis redis-cli INFO memory
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è

```bash
# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
docker-compose down
docker-compose up -d

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
./scripts/restore.sh latest_backup.sql

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./scripts/init_monitoring.sh
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Docker Compose](https://docs.docker.com/compose/)
- [Prometheus](https://prometheus.io/docs/)
- [Grafana](https://grafana.com/docs/)
- [GlitchTip](https://glitchtip.com/docs/)
- [Aiogram](https://docs.aiogram.dev/)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤
docker-compose logs -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs -f bot

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec bot python manage.py shell

# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —Å —Å–∂–∞—Ç–∏–µ–º
docker-compose exec postgres pg_dump -U schoolbot schoolbot | gzip > backup_$(date +%Y%m%d_%H%M%S).sql.gz

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 1 'docker stats --no-stream'
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

- **Issues**: GitHub Issues
- **Documentation**: README.md –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- **Monitoring**: Grafana –∏ GlitchTip –¥–∞—à–±–æ—Ä–¥—ã
- **Logs**: Docker logs –∏ GlitchTip

---

**üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!** –í–∞—à SchoolBot –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω-—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º DevOps-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è. 