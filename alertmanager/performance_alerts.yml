global:
  resolve_timeout: 5m
  slack_api_url: 'https://hooks.slack.com/services/YOUR_SLACK_WEBHOOK'

route:
  group_by: ['alertname', 'instance']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: 'telegram-admin'

receivers:
  - name: 'telegram-admin'
    telegram_configs:
      - bot_token: 'YOUR_BOT_TOKEN'
        chat_id: -1001234567890  # ID –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ —á–∞—Ç–∞
        parse_mode: 'HTML'
        message: |
          üö® <b>–ê–ª–µ—Ä—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</b>
          
          <b>–ê–ª–µ—Ä—Ç:</b> {{ .GroupLabels.alertname }}
          <b>–ò–Ω—Å—Ç–∞–Ω—Å:</b> {{ .GroupLabels.instance }}
          <b>–í—Ä–µ–º—è:</b> {{ .StartsAt | since }}
          
          <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b>
          {{ range .Alerts }}
          ‚Ä¢ {{ .Annotations.summary }}
          {{ end }}
          
          <b>–ú–µ—Ç—Ä–∏–∫–∏:</b>
          {{ range .Alerts }}
          ‚Ä¢ {{ .Annotations.description }}
          {{ end }}

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']

templates:
  - '/etc/alertmanager/template/*.tmpl'

# –ê–ª–µ—Ä—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
groups:
  - name: performance_alerts
    rules:
      # –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞
      - alert: BotResponseTimeHigh
        expr: avg_over_time(bot_latency_seconds_sum[5m]) > 2
        for: 5m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ"
          description: "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –±–æ–ª—å—à–µ 2 —Å–µ–∫—É–Ω–¥ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç"
          value: "{{ $value }}s"

      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
      - alert: BotResponseTimeCritical
        expr: avg_over_time(bot_latency_seconds_sum[5m]) > 5
        for: 2m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–æ—Ç–∞"
          description: "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –±–æ–ª—å—à–µ 5 —Å–µ–∫—É–Ω–¥ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç"
          value: "{{ $value }}s"

      # –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU
      - alert: HighCPUUsage
        expr: cpu_usage_percent > 80
        for: 5m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU"
          description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –ø—Ä–µ–≤—ã—à–∞–µ—Ç 80%"
          value: "{{ $value }}%"

      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU
      - alert: CriticalCPUUsage
        expr: cpu_usage_percent > 95
        for: 2m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU"
          description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –ø—Ä–µ–≤—ã—à–∞–µ—Ç 95%"
          value: "{{ $value }}%"

      # –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
      - alert: HighMemoryUsage
        expr: memory_usage_bytes / 1024 / 1024 > 1000
        for: 5m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏"
          description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1GB"
          value: "{{ $value }}MB"

      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
      - alert: CriticalMemoryUsage
        expr: memory_usage_bytes / 1024 / 1024 > 2000
        for: 2m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏"
          description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 2GB"
          value: "{{ $value }}MB"

      # –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
      - alert: SlowDatabaseQueries
        expr: rate(slow_queries_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î"
          description: "–ë–æ–ª–µ–µ 0.1 –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É"
          value: "{{ $value }} queries/sec"

      # –ú–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
      - alert: ManySlowQueries
        expr: rate(slow_queries_total[5m]) > 1
        for: 2m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤"
          description: "–ë–æ–ª–µ–µ 1 –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥—É"
          value: "{{ $value }} queries/sec"

      # –ù–∏–∑–∫–∏–π hit ratio –∫–µ—à–∞
      - alert: LowCacheHitRatio
        expr: cache_hit_ratio < 0.5
        for: 10m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–ù–∏–∑–∫–∏–π hit ratio –∫–µ—à–∞"
          description: "Hit ratio –∫–µ—à–∞ –Ω–∏–∂–µ 50%"
          value: "{{ $value }}%"

      # –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π hit ratio –∫–µ—à–∞
      - alert: VeryLowCacheHitRatio
        expr: cache_hit_ratio < 0.2
        for: 5m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π hit ratio –∫–µ—à–∞"
          description: "Hit ratio –∫–µ—à–∞ –Ω–∏–∂–µ 20%"
          value: "{{ $value }}%"

      # –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫
      - alert: HighErrorRate
        expr: rate(bot_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫"
          description: "–ë–æ–ª–µ–µ 0.1 –æ—à–∏–±–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É"
          value: "{{ $value }} errors/sec"

      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫
      - alert: CriticalErrorRate
        expr: rate(bot_errors_total[5m]) > 1
        for: 2m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫"
          description: "–ë–æ–ª–µ–µ 1 –æ—à–∏–±–∫–∏ –≤ —Å–µ–∫—É–Ω–¥—É"
          value: "{{ $value }} errors/sec"

      # –ú–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫
      - alert: ManyOpenTickets
        expr: bot_tickets_open > 50
        for: 10m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–ú–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫"
          description: "–ë–æ–ª–µ–µ 50 –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫"
          value: "{{ $value }} tickets"

      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–Ω–æ–≥–æ –∑–∞—è–≤–æ–∫
      - alert: CriticalOpenTickets
        expr: bot_tickets_open > 100
        for: 5m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫"
          description: "–ë–æ–ª–µ–µ 100 –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∑–∞—è–≤–æ–∫"
          value: "{{ $value }} tickets"

      # –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î
      - alert: HighDatabaseLoad
        expr: rate(db_query_duration_seconds_count[5m]) > 10
        for: 5m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"
          description: "–ë–æ–ª–µ–µ 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É"
          value: "{{ $value }} queries/sec"

      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î
      - alert: CriticalDatabaseLoad
        expr: rate(db_query_duration_seconds_count[5m]) > 50
        for: 2m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"
          description: "–ë–æ–ª–µ–µ 50 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É"
          value: "{{ $value }} queries/sec"

      # –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
      - alert: SlowDatabaseResponse
        expr: avg_over_time(db_query_duration_seconds_sum[5m]) > 1
        for: 5m
        labels:
          severity: warning
          service: schoolbot
        annotations:
          summary: "–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
          description: "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –±–æ–ª—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã"
          value: "{{ $value }}s"

      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
      - alert: CriticalDatabaseResponse
        expr: avg_over_time(db_query_duration_seconds_sum[5m]) > 3
        for: 2m
        labels:
          severity: critical
          service: schoolbot
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î"
          description: "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –±–æ–ª—å—à–µ 3 —Å–µ–∫—É–Ω–¥"
          value: "{{ $value }}s"

  # –ê–ª–µ—Ä—Ç—ã –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - name: load_test_alerts
    rules:
      # –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º —Ç–µ—Å—Ç–µ
      - alert: HighLoadTestRate
        expr: rate(load_test_requests_total[5m]) > 100
        for: 5m
        labels:
          severity: warning
          service: loadtest
        annotations:
          summary: "–í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º —Ç–µ—Å—Ç–µ"
          description: "–ë–æ–ª–µ–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É"
          value: "{{ $value }} requests/sec"

      # –û—à–∏–±–∫–∏ –≤ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º —Ç–µ—Å—Ç–µ
      - alert: LoadTestErrors
        expr: rate(load_test_errors_total[5m]) > 0.05
        for: 5m
        labels:
          severity: warning
          service: loadtest
        annotations:
          summary: "–û—à–∏–±–∫–∏ –≤ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º —Ç–µ—Å—Ç–µ"
          description: "–ë–æ–ª–µ–µ 5% –æ—à–∏–±–æ–∫"
          value: "{{ $value }} errors/sec"

  # –ê–ª–µ—Ä—Ç—ã –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
  - name: system_alerts
    rules:
      # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
      - alert: LowDiskSpace
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"} * 100) < 10
        for: 5m
        labels:
          severity: warning
          service: system
        annotations:
          summary: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ"
          description: "–°–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –º–µ–Ω—å—à–µ 10%"
          value: "{{ $value }}%"

      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–∞–ª–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
      - alert: CriticalDiskSpace
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"} * 100) < 5
        for: 2m
        labels:
          severity: critical
          service: system
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–∞–ª–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ"
          description: "–°–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –º–µ–Ω—å—à–µ 5%"
          value: "{{ $value }}%"

      # –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ç—å
      - alert: HighNetworkLoad
        expr: rate(node_network_receive_bytes_total[5m]) + rate(node_network_transmit_bytes_total[5m]) > 1000000000
        for: 5m
        labels:
          severity: warning
          service: system
        annotations:
          summary: "–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ç—å"
          description: "–ë–æ–ª–µ–µ 1GB —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ —Å–µ–∫—É–Ω–¥—É"
          value: "{{ $value }} bytes/sec" 